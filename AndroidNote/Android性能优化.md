# Android性能优化

#### 布局优化

布局优化的核心思想就是减少布局的层级，层级少，意味着`Android`绘制时的工作量少，程序的性能就提高了。

- 删除无用的层级和控件。
- 能采用`LinearLayout`就不用`RelativeLayout`，因为`RelativeLayout`的功能较复杂，它的布局需要花费更多的`CPU`时间；`FrameLayout`同理，但是有时候用`LinearLayout`或者`FrameLayout`需要通过嵌套才能实现产品效果，这种情况下应当采用`RelativeLayout`。
- `<include>` 和 `<merge>` 标签。

​       `<include>` 标签可以将一个指定的布局文件加载到当前的布局文件中 `<merge>` 标签和 `<merge>` 标签一起使用可以减少布局的层级。例如，当前布局是一个竖直方向的`LinearLayout`，被 `<include>` 的布局文件中根布局也是`LinearLayout`，通过 `<merge>` 标签就可以去掉多余的一层。

- `ViewStub`

​       `ViewStub`继承了`View`，它非常轻量级且宽高都是`0`,`ViewStub`的意义在于按需加载所需的布局文件。

****

#### 绘制优化

绘制优化是指`View`的`onDraw`方法要避免执行大量的操作：

- `onDraw`中不要创建新的局部对象，因为`onDraw`方法会被频繁调用，会导致内存抖动，引起系统频繁`GC`。
- `onDraw`中不要执行耗时操作，也不能执行成千上万次的循环操作。

​       `Google`官方给出的性能优化典范，`View`的绘制帧率保持在`60fps`是最佳的，这就要求每一帧的绘制时间不超过`16ms`。

****

#### 响应速度优化和ANR分析

响应速度优化的核心思想是避免在主线程中执行耗时操作，当有耗时操作时，可以放到子线程中。响应速度主要体现在`Activity`的启动速度上，`Android`规定，`Activity`如果`5s`内无法响应屏幕触摸事件或者键盘输入事件就会出现`ANR`，`BroadcastReceiver`如果`10s`内`onReceive`还未执行完操作也会出现`ANR`。

`ANR`发生之后，系统会在`/data/anr`目录下创建一个`traces.txt`文件，分析这个文件可以定位出`ANR`的原因。

****

#### 线程优化

线程优化的主要思想是采用线程池。线程池可以重用内部的线程，避免线程的创建于销毁所带来的性能开销，同时线程池还能有效地控制线程的最大并发数量，避免大量线程互相抢占系统资源从而导致阻塞现象的发生。

****